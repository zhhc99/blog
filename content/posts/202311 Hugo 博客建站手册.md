---
title: Hugo 博客建站手册
slug: hugo-blog-building-manual
date: 2023-11-01
author: hc
summary: 用 Hugo 建立个人博客站点.
tags:
  - Hugo
  - Blog
---

这是一份用 Hugo (version 0.119) 建立个人博客站点的手册.

> 2025.11 更新: 我将主题更换为 PaperMod, 因为 LoveIt 对新版本 Hugo (v0.147) 的支持不好.
> 
> TeX 渲染: 现在用 `layouts/partials/extend_head.html` 实现自定义的 KaTeX Auto-render 配置.

## 为什么选择 Hugo

- 静态网页
- 轻松配置环境
- 用 Markdown 书写博客
- 数学公式支持

## 安装 Hugo

在命令提示符 (下称终端) 中执行下列命令以安装 [Hugo](https://gohugo.io/):

```shell
winget install hugo.hugo.extended
```

这里安装的是 Hugo Extended. 相比于原始的 Hugo, 该版本支持带有 Sass 的 [Hugo 主题](https://themes.gohugo.io/). Winget 会自动为 Hugo 配置环境变量和符号链接, 这样您就可以在任何位置执行 `hugo` 命令. 在这之后, 执行 `hugo version` 以确认 Hugo 被正确安装.

## 番外: Git

[Git](https://git-scm.com/) 有助于维护主题和整个工程, 但不是必要的. 可以在终端执行下列命令以安装 Git:

```shell
winget install git.git
```

安装完成后, 执行 `git version` 以确认 Git 被正确安装.

我们还可以为 Git 手动配置 http 和 https 代理, 以解决网络环境不便于访问 Github 等站点的问题. 假如代理服务器的地址为 `http://127.0.0.1:1234`, 那么可以在终端中执行下列命令:

```shell
git config --global http.proxy http://127.0.0.1:1234
git config --global https.proxy http://127.0.0.1:1234
```

可以列出 Git 的配置文件, 检查代理是否已经配置好:

```shell
git config --global -l
```

## 建立 Hugo 站点

您可以直接 follow 官方教程 [Quick Start](https://gohugo.io/getting-started/quick-start/). 具体来说, 在您的工程目录 (如 `C:\Users\*username*\src\repos`) 打开终端, 然后按顺序执行下面的命令.

创建一个 Hugo 站点:

```shell
hugo new site *sitename*
```

Hugo 将会在目录 `*sitename*` 中新建一个 Hugo 站点. 我们进入该目录, 并启动 Hugo 开发服务器:

```shell
cd *sitename*
hugo server
```

如果一切顺利, 命令行将给出 Hugo Web Server 的地址. 在没有产生错误时, 该页面的内容是实时更新的.

在终端中输入下面的命令以新建一个 post:

```shell
hugo new content posts/*post-name*.md
```

该 post 是 markdown 文件, 遵循简洁高效的排版语法. 文件开头处自动添加的 metadata 默认如下:

```markdown
+++
title = '*post-name*'
date = xxxxxxxx
draft = true
+++
```

其中的 `draft` 条目代表文章是否为草稿. 草稿文章仅在 `hugo server -D` 参数下才会自动更新.

目前用浏览器访问该地址, 并不会显示任何内容. 这是因为, Hugo 需要 layout file 来生成网页. 我们添加任意主题就可以解决该问题.

## 添加主题

[Hugo Themes](https://themes.gohugo.io/) 提供了一些 Hugo 主题. 我推荐使用 [LoveIt](https://themes.gohugo.io/themes/loveit/), 因为该主题有中文文档, 并且内置了 KaTeX 以支持 TeX 语法的数学公式渲染. 可以用 Git Submodule 来添加该主题. 在 Hugo 站点目录中打开终端, 然后执行如下命令:

```shell
git init
git submodule add https://github.com/dillonzq/LoveIt.git themes/loveit
```

该主题将会安装在 `themes/loveit` 目录下. 您也可以单独下载主题文件, 并将所有文件置于该目录中. 无论如何, 在这之后, 从工程根目录处找到 `hugo.toml`, 在末尾添加一行:

```toml
theme = 'loveit'
```

完成这些设置后, 重新执行 `hugo server` 看看效果吧.

我现在使用的是 LoveIt v0.2.11. 如果想要探索该主题的更多设置, 您可以查看 [LoveIt 主页](https://hugoloveit.com/zh-cn/) 中的文档, 或者直接将 `themes/loveit/exampleSite/config.toml` 中感兴趣的条目添加到 `hugo.toml` 中并进行修改.

## 数学公式: LoveIt + Pandoc

在 `hugo.toml` 的末尾添加以下内容, 就可以按照 TeX 语法解析 markdown 中的数学公式.

```toml
[params.page.math]
  enable = true
```

尝试在刚刚创建的 post 文件中添加下面的内容:

```markdown
$$
f(x) = a x^2 + b x + c
$$

人们所熟知的是 $1 + 1 = 2$.

下面的公式将无法渲染:

$\underbrace{a}_{b} - \underbrace{c}_{d}$

$$
\begin{align*}
  & \min_{x} && f(x) \\
  & \mathop{\mathrm{s.t.}} && g(x) \leq 0 \\
  &                        && h(x) = 0
\end{align*} \tag{1}
$$
```

您可以看到, 一些公式已经正确渲染, 另一些则没有. 该问题应该归咎于 markdown 渲染器 BlackFriday 或 Goldmark, 这些渲染器在处理转义时未能忽略数学环境中的符号.

将 markdown 渲染器替换成 [Pandoc](https://pandoc.org/) 可以解决这个问题. 在终端中输入下面的命令就可以安装 Pandoc.

```shell
winget install JohnMacFarlane.Pandoc
```

在这之后请确认 `pandoc.exe` 所在的目录已经位于环境变量的 `Path` 中.

在 post 的 metadata 中, 添加如下一行即可将渲染器切换成 Pandoc:

```markdown
markup = 'pandoc'
```

此时, Hugo Server 应该会给出 access denied error, 我们只需要修改安全政策即可. 在 `hugo.toml` 中添加如下内容:

```toml
[security.exec]
  allow = ['^dart-sass-embedded$', '^go$', '^npx$', '^postcss$', '^pandoc$']
  osEnv = ['(?i)^(PATH|PATHEXT|APPDATA|TMP|TEMP|TERM)$']
```

现在, 刚刚 post 中的所有公式都将正确渲染.

如[官方文档](https://gohugo.io/getting-started/configuration-markup)所说的那样, 也可以修改默认 markdown 渲染器. 在 `hugo.toml` 中添加:

```toml
[markup]
  defaultMarkdownHandler = "pandoc"
```

即可修改默认渲染器为 Pandoc.

> 更换渲染器后, 一些仅 goldmark 支持的渲染特性将失效. 请查阅[官方文档](https://gohugo.io/getting-started/configuration-markup/).

## Hugo 站点发布

可以将 Hugo 站点发布到任意支持静态网页的托管平台. 您只需修改 `hugo.toml` 中的 `baseURL` 项目, 然后在站点目录执行:

```shell
hugo
```

Hugo 将在 `public` 目录下生成静态站点. 例如, 用 Github Pages 托管站点, 通过 `https://zhhc99.github.io/project-blog/` 访问, 那就应该设置成:

```toml
baseURL = 'https://zhhc99.github.io/project-blog/'
```

期待探索更多 Hugo 的玩法.

## 后记: 一些问题

### 网页图标 favicon 的路径处理

LoveIt 在为网页添加图标 (至于要添加哪些图标, 请参见 [Favicon Generator](https://realfavicongenerator.net/)) 时, 将从 `static/` 目录中寻找这些图标:

```
favicon.ico
apple-touch-icon.png
favicon-16x16.png
favicon-32x32.png
```

并根据 `static/` 目录中 `browserconfig.xml` 和 `site.webmanifest` 的配置, 寻找这些图标:

```
mstile-150x150.png
android-chrome-192x192.png
android-chrome-512x512.png
```

问题在于, LoveIt 在寻找这些图标以及两个配置文件时, 采用的是相对于所谓 "根目录" 的绝对路径, 而非相对于 `hugo.toml` 中的 `baseURL` 的路径. 如果您的 `baseURL` 是 `https://www.site.com/ada/`, 这些路径将从 `https://www.site.com/` 出发, 从而导致 LoveIt 找不到任何有效文件.

LoveIt 只在 `[params.app]` 中提供了 `svgFavicon` 参数, 该参数仅能修改 `<link rel="icon" href="*path-to-icon*/icon.xxx">` 对应的网页图标, 缺省值为 `/favicon.ico`.

[Issue #447](https://github.com/dillonzq/LoveIt/issues/447) 具体描述了该问题, 以及如何修改 `layouts/partials/head/link.html` 来解决该问题. 然而, 手动修改主题文件不是合适的解决方案.

另外, 在 Chromium 中测试网页图标时, 请用 `Ctrl + F5` 刷新.

### 修改主题的配置

主题文件应该作为 git submodule, 只接受来自主题作者的更新, 其中的配置应该被看作主题的默认配置. Hugo 站点维护者不应该修改主题文件.

如果想修改主题内某个文件 `themes/*theme-name*/*path-to-file*/file.xyz` 中的配置, 正确的方法通常是, 在 Hugo 工程目录中创建相同的 `*path-to-file*/file.xyz` 并做出对应修改. Hugo 将用该文件替代主题中的默认配置文件.
